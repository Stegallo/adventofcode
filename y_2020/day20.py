import re

from .common import AoCDay
from .utils import prod
import json


class Tile:
    def __init__(self, borders):
        self.n_border = borders[0]
        self.e_border = borders[1]
        self.s_border = borders[2]
        self.w_border = borders[3]

    def flip(self):
        return Tile(
            [
                self.s_border,
                "".join(reversed(list(self.e_border))),
                self.n_border,
                "".join(reversed(list(self.w_border))),
            ]
        )

    def rotate90(self):
        return Tile(
            [
                "".join(reversed(list(self.w_border))),
                self.n_border,
                "".join(reversed(list(self.e_border))),
                self.s_border,
            ]
        )

    def rotate180(self):
        return Tile(
            [
                "".join(reversed(list(self.s_border))),
                "".join(reversed(list(self.w_border))),
                "".join(reversed(list(self.n_border))),
                "".join(reversed(list(self.e_border))),
            ]
        )

    def rotate270(self):
        return Tile(
            [
                self.e_border,
                "".join(reversed(list(self.s_border))),
                self.w_border,
                "".join(reversed(list(self.n_border))),
            ]
        )


class SetEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, set):
            return list(obj)
        return json.JSONEncoder.default(self, obj)


class Day(AoCDay):
    def __init__(self):
        super().__init__(20)

    def _preprocess_input(self, do=False):

        self.__adj = {
            2729: {3217, 3181, 1879},
            3673: {2203, 2797, 1279},
            2797: {2423, 3673, 2861},
            3779: {2341, 2237, 3271, 1741},
            3217: {1721, 2729, 3001},
            3137: {1601, 1627, 1741},
            2857: {1361, 2467, 1993, 2719},
            1831: {2309, 1109, 1319, 2143},
            2423: {2549, 1019, 2797, 1279},
            3221: {2663, 2269, 2399},
            2707: {3467, 2621, 1543},
            3041: {2039, 1721, 3001, 3803},
            1627: {3137, 3671, 2027},
            1237: {2099, 3067, 1609, 1867},
            1187: {3457, 3181, 3517},
            1361: {3457, 2857, 3517, 1327},
            2087: {1657, 1129, 2441, 3967},
            1129: {1249, 2087, 1321, 3677},
            1093: {2399, 3533, 2957, 1231},
            3049: {1153, 3931, 2251, 1787},
            2399: {1093, 3221, 1609, 1583},
            3371: {3557, 2039, 3803, 1949},
            3343: {2309, 2341, 1637, 2237},
            2393: {1747, 1847, 3163, 2887},
            1621: {2803, 3229, 1039},
            3181: {3697, 2729, 1187},
            2441: {2833, 2087, 1993, 2719},
            2389: {1009, 3671, 2699},
            1847: {3347, 2791, 2393, 2957},
            1871: {1429, 1543, 2621},
            3877: {1637, 3541, 3163, 2237},
            3517: {1361, 2003, 1187},
            2609: {1489, 3557, 1867, 2687},
            3001: {3217, 3041, 1663},
            3067: {3617, 1237, 3413, 2053},
            1583: {2663, 2791, 2957, 2399},
            1741: {3137, 3779, 2027, 1931},
            1933: {1901, 3533, 2957, 3347},
            3697: {3457, 3181, 2671, 1879},
            1429: {2351, 1871, 1663},
            1721: {3041, 3217, 1879, 1439},
            1867: {2609, 3617, 1237, 1231},
            2143: {3533, 1619, 1831, 1901},
            1657: {1249, 2833, 2087, 2333},
            2719: {3967, 2857, 2441, 3391},
            2803: {3541, 1601, 1621},
            3929: {2161, 2833, 2953, 2333},
            1321: {2081, 1129, 2549, 3637},
            1153: {2657, 1009, 3049, 2699},
            3803: {3041, 1861, 3371, 1439},
            2791: {1847, 1021, 2887, 1583},
            3529: {1571, 3671, 2027, 2699},
            3257: {2081, 1907, 1571, 3301},
            1531: {1889, 3323, 2861},
            3413: {3467, 3067, 2621, 1949},
            1117: {2003, 1559},
            1499: {1297, 1747, 2887, 3373},
            1787: {1907, 1571, 3049, 2699},
            1949: {3617, 3413, 3371, 2351},
            2161: {1879, 3929, 2671, 1439},
            2953: {2417, 1861, 3929, 1439},
            1039: {3373, 1747, 1621},
            2027: {3271, 3529, 1627, 1741},
            1889: {3967, 1531, 1019, 3391},
            3557: {3617, 2609, 1861, 3371},
            2549: {3677, 2423, 1321, 2381},
            1543: {2707, 1871},
            2417: {1319, 2953, 2333, 2687},
            3541: {3877, 1931, 2803, 3229},
            1931: {1741, 1601, 3541, 2237},
            2833: {1657, 3929, 2441, 2671},
            3301: {3121, 2341, 3271, 3257},
            3671: {3529, 1627, 2389},
            1609: {1237, 2399, 2269, 1231},
            2957: {1093, 1847, 1933, 1583},
            2467: {1327, 2857, 2617, 3391},
            1907: {3257, 2251, 2381, 1787},
            2251: {1907, 3049, 2203, 1279},
            2657: {1153, 3931, 1291},
            2671: {2161, 3697, 2833, 1993},
            3121: {2081, 3011, 3637, 3301},
            1021: {1973, 2663, 2791},
            1019: {1889, 3677, 2423, 2861},
            2099: {1237, 2053, 2269},
            1297: {1499, 1213, 1973},
            1993: {3457, 2857, 2441, 2671},
            2617: {2467, 1559, 3323},
            1009: {1153, 2389, 1291},
            2203: {3673, 3931, 2251},
            3467: {2707, 2053, 3413},
            3617: {3557, 3067, 1867, 1949},
            1601: {3137, 2803, 1931},
            2699: {1153, 2389, 3529, 1787},
            1231: {1489, 1093, 1609, 1867},
            3373: {1499, 1213, 1039},
            1901: {2309, 1637, 1933, 2143},
            1213: {1297, 3373},
            3163: {2393, 3347, 3877, 3229},
            2053: {2099, 3067, 3467},
            3229: {1747, 3541, 1621, 3163},
            3271: {1571, 3779, 3301, 2027},
            2003: {1327, 1117, 3517},
            3637: {1249, 3121, 1109, 1321},
            3967: {1889, 2087, 3677, 2719},
            2621: {2707, 3413, 1871, 2351},
            3347: {1637, 1847, 3163, 1933},
            1319: {2417, 1619, 1831, 3727},
            1279: {2423, 3673, 2251, 2381},
            1861: {3557, 2953, 3803, 2687},
            2861: {1531, 2797, 1019},
            1879: {2161, 3697, 1721, 2729},
            1291: {2657, 1009},
            1109: {3011, 3637, 1831, 3727},
            2333: {1657, 2417, 3929, 3727},
            2081: {3121, 1321, 3257, 2381},
            1489: {2609, 1619, 3533, 1231},
            3931: {2657, 3049, 2203},
            1249: {1657, 3637, 1129, 3727},
            2381: {2081, 1907, 2549, 1279},
            1747: {1039, 2393, 1499, 3229},
            2687: {2417, 2609, 1619, 1861},
            1327: {1361, 2467, 2003, 1559},
            3727: {1249, 1109, 1319, 2333},
            2341: {3779, 3011, 3301, 3343},
            1439: {2161, 1721, 2953, 3803},
            2351: {1429, 2039, 2621, 1949},
            2269: {2099, 3221, 1609},
            2887: {1973, 2791, 2393, 1499},
            3391: {1889, 2467, 3323, 2719},
            3533: {1489, 1093, 1933, 2143},
            1637: {3347, 3877, 1901, 3343},
            3323: {2617, 1531, 3391},
            1559: {2617, 1117, 1327},
            2039: {3041, 3371, 2351, 1663},
            3677: {2549, 1129, 1019, 3967},
            1973: {1297, 1021, 2887},
            2309: {3011, 1831, 1901, 3343},
            2237: {3779, 3877, 1931, 3343},
            2663: {3221, 1021, 1583},
            1571: {3271, 3257, 1787, 3529},
            3011: {3121, 2341, 1109, 2309},
            3457: {1361, 3697, 1187, 1993},
            1619: {1489, 1319, 2143, 2687},
            1663: {1429, 2039, 3001},
        }
        self.__tiles = {
            "2729": [
                ".....#####",
                "##..##.#.#",
                "......#.##",
                "#....#.#.#",
                "#......##.",
                "#...#..#.#",
                "#.........",
                ".......##.",
                "#.#..#....",
                "#.#.###..#",
            ],
            "3673": [
                "##.....###",
                ".....##...",
                "#.......#.",
                "..#..##.##",
                "...##.#...",
                "...#......",
                "..#...#..#",
                "..........",
                "##..#.#..#",
                "####.#.#.#",
            ],
            "2797": [
                "#######..#",
                "###..#.#.#",
                "#...#.....",
                "....#...#.",
                "....#...#.",
                "#...##....",
                "....#....#",
                "#..#......",
                ".#........",
                "#.#.....##",
            ],
            "3779": [
                "....###..#",
                "#..#......",
                "...##.....",
                "#.#..#...#",
                "..##.#....",
                "##.##....#",
                "#.........",
                ".....#...#",
                "#.###...#.",
                ".#####.#.#",
            ],
            "3217": [
                "...###.###",
                "#....#..##",
                "#.......#.",
                "......#..#",
                "#...##..##",
                "##..#....#",
                "#...####.#",
                "..#..##...",
                "..#.##...#",
                "#..#.###..",
            ],
            "3137": [
                ".#..#.#.#.",
                "#.......#.",
                "###...#..#",
                "#.#...#...",
                ".....#.#.#",
                "..#..#....",
                "#...#.#.##",
                "..#......#",
                "..#...#...",
                "###.##.##.",
            ],
            "2857": [
                "...##..##.",
                ".........#",
                "#........#",
                ".#.....#..",
                "#..#..#...",
                "#...#.#.#.",
                "##....####",
                "#.....##.#",
                "...#..#...",
                "..####....",
            ],
            "1831": [
                "#.##..####",
                ".#.#.#...#",
                "#..##.....",
                "#..#....#.",
                "#.##......",
                "...#....#.",
                "......#..#",
                "..........",
                "####..#...",
                "####.###..",
            ],
            "2423": [
                "...#.##..#",
                "#...##...#",
                "##......##",
                "...#.#....",
                "#.....#...",
                "#.....#..#",
                ".#..####..",
                ".##...#.##",
                "..##.#..#.",
                "#..#..####",
            ],
            "3221": [
                "..#.##.###",
                "#.#.......",
                "#...#....#",
                "...#...#..",
                "#..#.#...#",
                "....###..#",
                ".........#",
                ".........#",
                "#...#.##.#",
                "##..##.###",
            ],
            "2707": [
                ".##.#.#...",
                ".#.##..#.#",
                "#...#.....",
                "#.#.......",
                "#...#.....",
                "..#......#",
                ".......###",
                "..#.#...#.",
                "#.#.......",
                "..#...#.##",
            ],
            "3041": [
                "#.####...#",
                "##.....#..",
                "..#.#..###",
                "#.###..###",
                ".#.#.....#",
                "#....#....",
                "..##......",
                ".###....#.",
                "###.##.#..",
                "#####.##.#",
            ],
            "1627": [
                ".###..#..#",
                ".#..#.##..",
                "##...#...#",
                "#....###.#",
                "..#......#",
                "#....#..#.",
                "#.##.....#",
                ".##..#...#",
                "..#...#..#",
                "...#.###.#",
            ],
            "1237": [
                "...##..###",
                "#.#......#",
                "#.##..#..#",
                "#.#.....#.",
                "#....#...#",
                "...#....#.",
                "#.#....#..",
                ".##.......",
                "..#..#..##",
                ".###.#.#.#",
            ],
            "1187": [
                "#...###...",
                "#.###.#...",
                "..##...#..",
                "##.....#..",
                ".....#...#",
                "#.....#...",
                "....#..#.#",
                ".........#",
                ".#...#....",
                ".####.#.##",
            ],
            "1361": [
                ".#.##..###",
                "......#..#",
                "....#.#..#",
                ".#.......#",
                "#.#.....##",
                ".#.#..##..",
                "##.##....#",
                "#.##..#.##",
                "#.#......#",
                ".##..##...",
            ],
            "2087": [
                "###.#.....",
                ".#...#....",
                ".#..#.....",
                "####.....#",
                "...#.....#",
                "...##.....",
                "##..###..#",
                "....##..#.",
                ".#.####...",
                "...#..####",
            ],
            "1129": [
                "###.#.#...",
                "#.##..###.",
                ".....#....",
                "#...#..#..",
                "#.#.###.#.",
                ".##..###..",
                "#...##..##",
                ".....#...#",
                "#........#",
                "...#..####",
            ],
            "1093": [
                ".....##.##",
                "#.......##",
                ".##.#.##.#",
                "#.#..####.",
                "#....#....",
                "###......#",
                "#.#.......",
                "#..#.....#",
                "#..#.#.#..",
                "#..#....#.",
            ],
            "3049": [
                "##...#..##",
                "#........#",
                "#......#..",
                ".....#.###",
                "#........#",
                "#..#.#....",
                "#........#",
                "....#.....",
                "..##.....#",
                "##.#..##.#",
            ],
            "2399": [
                "##...#.##.",
                "...#......",
                "#.#.##...#",
                "##.......#",
                "#.........",
                "#.........",
                ".....##..#",
                "#....#....",
                ".........#",
                ".....##.##",
            ],
            "3371": [
                "##....##..",
                ".....##...",
                "##.##.#.##",
                "......###.",
                "##..####.#",
                "..#..##..#",
                ".....#...#",
                "#..#..#..#",
                ".##.#...##",
                ".####..###",
            ],
            "3343": [
                "#......##.",
                ".##.#.#..#",
                "#...#.##.#",
                ".##..##...",
                ".#.#....##",
                "##.#..#...",
                "#....#.#.#",
                ".....##..#",
                "#.....##.#",
                ".##.#....#",
            ],
            "2393": [
                ".####.#.#.",
                ".#..##....",
                ".##..#.#..",
                "#....#....",
                "#...##.##.",
                ".#...#...#",
                "#..#......",
                "....#.##.#",
                "#....##..#",
                ".#..###.#.",
            ],
            "1621": [
                "##..###..#",
                "##.....#..",
                "#.#....###",
                ".##..#.#.#",
                "#.........",
                "#......#.#",
                "#.#.......",
                ".#........",
                "#.#......#",
                "....####.#",
            ],
            "3181": [
                "#...#.####",
                "...#.#...#",
                "..........",
                "....#..#..",
                "##........",
                "......####",
                "#.#..#..##",
                "..........",
                "..#....##.",
                "...###...#",
            ],
            "2441": [
                ".#..#..#..",
                "#....##...",
                ".#...#.#..",
                "#...##..#.",
                "...#..###.",
                ".....#.#.#",
                "#...#...#.",
                "#...##...#",
                "#......#.#",
                "#...##..##",
            ],
            "2389": [
                ".#...#.#..",
                ".........#",
                "..........",
                "###.......",
                "....#.#...",
                "....#.##..",
                "#.....##.#",
                "..#.......",
                "#.##.....#",
                "#...###.##",
            ],
            "1847": [
                "#.###.#..#",
                "#.#...#.#.",
                "#.......##",
                "#...#..#.#",
                "..###.#..#",
                "...##....#",
                "#....#...#",
                "##...#...#",
                ".###...#..",
                ".#.#.####.",
            ],
            "1871": [
                ".###.##...",
                "#.......#.",
                "#.......#.",
                "#.....#..#",
                "..##...#.#",
                "##.....###",
                ".....###..",
                "#....###.#",
                "##.##..#..",
                "###...####",
            ],
            "3877": [
                "#.....#.#.",
                "..##....##",
                "###......#",
                "#...###...",
                ".##...##..",
                ".#...#....",
                "..#....#.#",
                "#.........",
                "...#..#...",
                "#..###.#..",
            ],
            "3517": [
                "###..##.#.",
                "...###...#",
                "..#......#",
                ".#.#...#.#",
                "....#.##.#",
                "#...#..#..",
                "...##....#",
                "#.....###.",
                ".#..##...#",
                "........##",
            ],
            "2609": [
                "#...#..###",
                ".........#",
                "...#.#.#..",
                "#####..#.#",
                "#.#....#.#",
                ".......#..",
                "###..#...#",
                "..........",
                ".#...#....",
                "#.#.....#.",
            ],
            "3001": [
                "..#...#...",
                "#........#",
                "#..#.....#",
                ".#.#.#...#",
                "#..##.....",
                "#.....##..",
                "#......#.#",
                "..##...#..",
                ".#..#.##.#",
                "#.##.#####",
            ],
            "3067": [
                "#.#.#.###.",
                "##....#...",
                ".#..#.....",
                "....#.....",
                ".###..#.##",
                ".....#....",
                ".#...##...",
                ".#.#.##..#",
                ".....#...#",
                "#.#.#....#",
            ],
            "1583": [
                "####....#.",
                "##.#....##",
                "##..#....#",
                "#...#.##..",
                "....##....",
                "###.##...#",
                "#..#..##.#",
                ".###.....#",
                ".#.##....#",
                "..#.####.#",
            ],
            "1741": [
                "#.#.#####.",
                "....#.....",
                "#.#......#",
                "..##...###",
                "......#...",
                "#........#",
                "..##...###",
                "#.#...####",
                "####.#....",
                ".#..#.#.#.",
            ],
            "1933": [
                "#####..###",
                "#...#..#..",
                ".##...#..#",
                ".......###",
                "##........",
                "..#...##..",
                ".....#..##",
                "#....#....",
                "#.....#.#.",
                "....##..#.",
            ],
            "3697": [
                "#..#.#####",
                "...#..##..",
                "#.....#...",
                ".#..#.##..",
                "......#...",
                "#......#..",
                "##....#..#",
                ".##.....#.",
                "#.#..#....",
                "#..##...##",
            ],
            "1429": [
                "##.....#..",
                "###.#...##",
                "#.....#..#",
                "#...###..#",
                "....#.....",
                "##.#...#..",
                "#....##...",
                ".##.#..#..",
                "..#.#.#..#",
                "#.#.###...",
            ],
            "1721": [
                "##..#.#..#",
                "...#.#....",
                "##...#.#.#",
                "##..#....#",
                ".##.#....#",
                "#..#.#....",
                "#.##.#....",
                "##.....#..",
                "..#..###..",
                "..###.#..#",
            ],
            "1867": [
                ".##.####.#",
                "#.##....#.",
                "#....#....",
                "##..#..#..",
                "##.#..#..#",
                ".......#..",
                "##........",
                "..#...##.#",
                "....#..#.#",
                "..###.#.##",
            ],
            "2143": [
                "##..##.#..",
                "#.........",
                "..#.#..###",
                ".#.#..#...",
                ".#######..",
                "....#....#",
                "##.##.#..#",
                "......##..",
                "..#.#.##.#",
                "..#...#..#",
            ],
            "1657": [
                "......#..#",
                "#.##..###.",
                ".#.....#.#",
                ".#......##",
                "#.####...#",
                "...#.#....",
                "#.#....###",
                "#.....##.#",
                "....#....#",
                "#..#..#...",
            ],
            "2719": [
                "#####..#..",
                "#.....###.",
                ".##....###",
                "..#.##....",
                "#..##.....",
                ".......###",
                "#.....#...",
                "..#...##..",
                ".#..##.#.#",
                "..####....",
            ],
            "2803": [
                "###..###..",
                ".#..#...##",
                "#.....#...",
                "#.#.###...",
                "##..#....#",
                "#...#..#.#",
                "...##...##",
                "......####",
                ".......##.",
                ".###.#..##",
            ],
            "3929": [
                ".#.#####.#",
                "##...#....",
                "...#.#.#.#",
                ".#......#.",
                ".......#..",
                "##....##.#",
                "...#...#..",
                ".......###",
                ".........#",
                "..##..##.#",
            ],
            "1321": [
                ".#.#...#.#",
                ".......#..",
                "...#.####.",
                "#.........",
                "..#.#.#.##",
                "##....#...",
                "..........",
                "#.##...#..",
                "#....#...#",
                "#######.##",
            ],
            "1153": [
                ".#...#.###",
                "#........#",
                "#...#...#.",
                "#.....#..#",
                "#........#",
                "#.#.....##",
                ".....##...",
                "#..#...#..",
                "#.....#..#",
                "##.#..##.#",
            ],
            "3803": [
                "#.####...#",
                "#.##..#...",
                "##..#.....",
                ".##.....#.",
                "..#...#...",
                "#.##.#.#..",
                "##.....#.#",
                "##.#..#..#",
                "##..#..#..",
                "....##..##",
            ],
            "2791": [
                ".#....####",
                "#.....#...",
                "#.#.##...#",
                "..#.#.#..#",
                "##..#....#",
                "#....#..##",
                "...#.##..#",
                "......#..#",
                "#....#.#..",
                "#.###.#.#.",
            ],
            "3529": [
                ".#...#...#",
                ".....#..#.",
                "#........#",
                ".........#",
                ".##.##.#..",
                "##.......#",
                "#...#...##",
                ".......#..",
                "...#.##..#",
                "#.#####...",
            ],
            "3257": [
                "####.#.###",
                ".##...##..",
                "..#....#..",
                "..###..#.#",
                "#.#..#...#",
                ".......##.",
                "##.##.####",
                ".....##..#",
                "#....##...",
                "###..###.#",
            ],
            "1531": [
                "#.#...#...",
                ".........#",
                "##...#...#",
                "##......##",
                "...#.....#",
                "#.#.###..#",
                "#....#...#",
                ".#....#.#.",
                "#...#....#",
                "#########.",
            ],
            "3413": [
                "#...#.....",
                "...###..##",
                "##..##....",
                ".#..##....",
                "#..#.#.#..",
                "...#.....#",
                "....#..#.#",
                "...#....##",
                "...#.#...#",
                "#.###..#.#",
            ],
            "1117": [
                "#.#.##...#",
                ".........#",
                ".........#",
                "#....#..##",
                "#.#.##..#.",
                "#......#..",
                "#.#.#.#...",
                "#..#.....#",
                "......#.#.",
                "..##.#..#.",
            ],
            "1499": [
                ".#####..##",
                "...#...###",
                ".........#",
                "#..#.....#",
                "##......##",
                "#.......#.",
                "#......##.",
                "#####.....",
                ".#.....#..",
                ".###..####",
            ],
            "1787": [
                ".######..#",
                "#....#.#.#",
                "........#.",
                "#.....#...",
                "..........",
                "..#..#.###",
                "#.#..#...#",
                ".#.#.#####",
                ".....#.#.#",
                "##.#.##.##",
            ],
            "1949": [
                "##..####.#",
                "##.#......",
                ".........#",
                "....#..#.#",
                ".#...##..#",
                "....#..#..",
                "#.....#...",
                "##....#..#",
                ".....#..#.",
                ".#.#.#.#.#",
            ],
            "2161": [
                "####.#..#.",
                "#.......#.",
                ".##....#.#",
                ".###..#..#",
                "#.#..#....",
                "#..#..#...",
                "#...#.#.##",
                "#...#.##.#",
                "###....#..",
                "#...#.##.#",
            ],
            "2953": [
                "#.#...#.##",
                "#.#.#...##",
                "#.......##",
                ".........#",
                "#..#.....#",
                "..#.##.#..",
                "..#.###..#",
                "##.....#..",
                "......#...",
                "###.#.#.#.",
            ],
            "1039": [
                "##..###..#",
                "#.....#...",
                "#....#.#.#",
                "#...#...##",
                "##.......#",
                "#.....#..#",
                "...#.....#",
                ".#.###...#",
                ".........#",
                "#.#..#####",
            ],
            "2027": [
                "##.####..#",
                "..#.....#.",
                "#.#.##...#",
                ".#.......#",
                ".....#.###",
                "#........#",
                ".#.#.....#",
                "#.#...#.#.",
                "#.###...#.",
                "..##.##...",
            ],
            "1889": [
                "..####.##.",
                "#....#.#.#",
                "##.#..##.#",
                "#..#...###",
                "##...#..##",
                "#..##...#.",
                "#..#.###.#",
                "#.###.#...",
                "##...##...",
                "##.##..###",
            ],
            "3557": [
                "##.##.#...",
                ".....#.#.#",
                "#.#..#....",
                "##..###..#",
                "....##...#",
                "....#....#",
                ".#..#...#.",
                ".#.#.##..#",
                "###..#...#",
                "#.#.#..#..",
            ],
            "2549": [
                "....#..#..",
                "#..#..#.##",
                ".....#...#",
                "#..##.#.#.",
                ".#.##....#",
                ".#..#....#",
                ".#.#...#..",
                "##.....#..",
                "..........",
                "#....#...#",
            ],
            "1543": [
                ".##.###.##",
                "....#.#..#",
                "#.........",
                "...#.#...#",
                "#.......#.",
                ".....##...",
                "....#.....",
                "..###.#..#",
                "###..#....",
                "###.#.###.",
            ],
            "2417": [
                ".#....#.#.",
                "#.#..###.#",
                "....##....",
                "##.....#.#",
                "..........",
                "#....#..##",
                ".....#...#",
                "#.#......#",
                "#........#",
                "###..##..#",
            ],
            "3541": [
                ".##..###..",
                "##...##.##",
                "##..#....#",
                ".........#",
                "...#.#....",
                "...#.....#",
                "#..#...#..",
                "..........",
                ".#..##.#.#",
                "..##.#..##",
            ],
            "1931": [
                ".##...##.#",
                "...#.....#",
                "#...###...",
                "#.......#.",
                "#.......##",
                ".#.#.#....",
                "##..#....#",
                "##...#..##",
                "..........",
                "....#.#.#.",
            ],
            "2833": [
                ".#...#....",
                "#..####...",
                ".#...##.##",
                ".#.......#",
                "#.#...#..#",
                "..#.....##",
                "#......#..",
                "##....#..#",
                "......#..#",
                "##..##...#",
            ],
            "3301": [
                "###.#.####",
                "..###.##..",
                "..........",
                ".#....##..",
                "#.#..##...",
                "..#....#.#",
                ".#.#..#...",
                "#.#..#...#",
                "....#.##.#",
                "......##.#",
            ],
            "3671": [
                "##.#..#...",
                ".##....###",
                "##.....#..",
                "###.#.#.#.",
                "....#...##",
                "#.....#..#",
                "#.#......#",
                ".......###",
                "#..#.....#",
                "...#.###.#",
            ],
            "1609": [
                "..##..#.##",
                "###..##...",
                ".#..#..#..",
                "#....#.#..",
                "#..#.##.#.",
                "#.......#.",
                ".....#...#",
                "#.....#..#",
                "......##..",
                "###..##...",
            ],
            "2957": [
                "###..#####",
                "###.......",
                "#..#.....#",
                "#.#......#",
                "#.....#..#",
                "#.#.......",
                "###.#..#.#",
                ".#.#.##.#.",
                "###.#.#...",
                "...##.####",
            ],
            "2467": [
                "##.#.#.#..",
                "........#.",
                "....#...#.",
                "#.......#.",
                "..#...#..#",
                "...#.#...#",
                "#...###.##",
                "#.##.#.#..",
                ".#...##...",
                "..#.####..",
            ],
            "1907": [
                "###..###.#",
                "#...#....#",
                "...#..#..#",
                ".......#.#",
                "........##",
                "##...#..##",
                "#..#.##...",
                "#....#.#.#",
                "#......###",
                "###.....#.",
            ],
            "2251": [
                "##...#..##",
                "#..#.##..#",
                "..#.#..###",
                "##........",
                ".......#..",
                ".#..#.#...",
                "#..#.#..#.",
                "#..#......",
                "###.#...##",
                "#.###.##..",
            ],
            "2657": [
                ".#..##..##",
                "##.#....##",
                "#.#...#...",
                "#..#......",
                "#........#",
                "#.........",
                "..#....#..",
                "#.........",
                "#.........",
                "##.###.###",
            ],
            "2671": [
                "#.#.#.##.#",
                ".#..#..#.#",
                ".#.......#",
                "#...#..#..",
                ".....###.#",
                "#.....#..#",
                "#.#......#",
                "#........#",
                "#....#....",
                "####.#..#.",
            ],
            "3121": [
                "..#..#...#",
                "#....#...#",
                "....###.#.",
                "#........#",
                "..####....",
                ".......###",
                "#..#.####.",
                "##.#.###.#",
                ".####..#..",
                "#.#...#..#",
            ],
            "1021": [
                "#####.####",
                "#....#...#",
                "####....#.",
                "#......#..",
                "##..#...##",
                "##.#.#..##",
                "#.....#.#.",
                "#.#...##.#",
                ".#......##",
                ".#.##...#.",
            ],
            "1019": [
                "...#.##..#",
                "#........#",
                ".........#",
                "##....#...",
                "#..#..##.#",
                "........#.",
                ".....##...",
                "#..##....#",
                "#.....#.#.",
                ".##.####..",
            ],
            "2099": [
                "#.##..###.",
                "#..#......",
                "#.##...#.#",
                "...##..##.",
                "#...#.....",
                ".#.....#.#",
                ".....#..#.",
                ".....##...",
                "#...##..##",
                "##.#####.#",
            ],
            "1297": [
                ".###..####",
                "##...###.#",
                "..#..##..#",
                "#...#.....",
                "...#....##",
                "#....#...#",
                "###.##.#..",
                "#.........",
                "......#.##",
                "..#.##..#.",
            ],
            "1993": [
                "####..#.#.",
                ".#.#.#....",
                "#...#.##.#",
                "#.....#..#",
                "..#..#.#..",
                "#.#.#...#.",
                ".#..#...#.",
                "##...##..#",
                "..#...##.#",
                "#..#.##.#.",
            ],
            "2617": [
                "..#.#.#.##",
                ".##.####..",
                "#.#..####.",
                "....#.#..#",
                "#.#.#.#.##",
                "...#......",
                "##......##",
                ".#...#.#..",
                "#..#...#.#",
                ".###.#..#.",
            ],
            "1009": [
                "##.#....#.",
                "#.#.#...#.",
                "#.#....#..",
                "......#..#",
                "####......",
                "....#...##",
                "......#..#",
                ".......#..",
                "##.....#..",
                "..#...#.#.",
            ],
            "2203": [
                "#.#.###.##",
                "#.#...##.#",
                "....#.##.#",
                "#..#......",
                ".#....#..#",
                "......#...",
                "##.##....#",
                "#...#...#.",
                "##.##....#",
                "#..#..#.##",
            ],
            "3467": [
                "....##.##.",
                "#...#..#..",
                "##....#...",
                "#.......##",
                "#.........",
                "...#....##",
                "#...#.....",
                "##.#.#.#.#",
                "...##.#..#",
                "#...#.....",
            ],
            "3617": [
                "##..####.#",
                "#...#.#..#",
                ".......#.#",
                "..........",
                ".......#..",
                "...#...###",
                "#.#.......",
                "#.........",
                ".....##...",
                "##.#.###..",
            ],
            "1601": [
                ".#..####.#",
                ".....##...",
                "#.....##.#",
                "#...###..#",
                "##....#...",
                "##......#.",
                "#.#.....#.",
                "##.......#",
                "#.......##",
                "..##.#.#..",
            ],
            "2699": [
                ".#...#...#",
                "#.##...##.",
                "..........",
                "#.##..#.#.",
                "...#..#..#",
                "...#.##..#",
                "#.#..#..##",
                ".#...###..",
                ".#.......#",
                "##..###.##",
            ],
            "1231": [
                "#.....##..",
                "#..#.....#",
                "###..#.#.#",
                "..######..",
                "...##....#",
                "#..#...#.#",
                ".....#...#",
                "#.##..####",
                "..#.#.....",
                ".###.##..#",
            ],
            "3373": [
                "###...#...",
                ".##..#...#",
                ".#.#.....#",
                "........#.",
                "....#.....",
                "#....#....",
                "##.....#.#",
                "###.......",
                "#......#.#",
                "#.#..#####",
            ],
            "1901": [
                "##.##..##.",
                "##...#..##",
                "......#..#",
                ".#.#......",
                "#.###.#..#",
                "##.#.#.#..",
                "........##",
                "#....#..#.",
                ".....#...#",
                ".#..##....",
            ],
            "1213": [
                "...#.#.#.#",
                "#.##...#..",
                ".#.##.####",
                ".....####.",
                "##.##....#",
                "#..#...#..",
                "....#.....",
                "##........",
                "##..##....",
                "###...#...",
            ],
            "3163": [
                "#.....#.#.",
                "###.#..#..",
                "......#...",
                "#..#.#....",
                "##....#.#.",
                "##.#..##..",
                "#.##.#..##",
                ".#........",
                ".#...#....",
                ".....#.##.",
            ],
            "2053": [
                ".###.#...#",
                "#.....#...",
                "#..#.#..##",
                "##.......#",
                "#..#....##",
                "....###..#",
                "#.#..#...#",
                "#.##.#.#..",
                ".#..#..#.#",
                "#.......##",
            ],
            "3229": [
                "......#...",
                "#...#....#",
                "##....#..#",
                ".#..#.##.#",
                "..####.#.#",
                "###.......",
                "##....#...",
                "#..#...#.#",
                "........#.",
                ".#.###.###",
            ],
            "3271": [
                "#....#.###",
                "#.......#.",
                "#......#..",
                ".###..##.#",
                "....#..#..",
                ".....#..##",
                ".#...#....",
                "........##",
                ".......##.",
                "#..####.##",
            ],
            "2003": [
                "..#.#....#",
                ".##..#...#",
                "#.........",
                "#.........",
                "#.........",
                "#.##...#..",
                "#..#..##.#",
                ".......#..",
                "##.......#",
                "..#####..#",
            ],
            "3637": [
                "##.##.####",
                "....#.#..#",
                "##.#...#.#",
                "....###.##",
                "..........",
                ".##.###.#.",
                "#.###.....",
                "......#...",
                "..##.....#",
                "##.#######",
            ],
            "3967": [
                "#..#.####.",
                "###..#....",
                "#.........",
                "#..#..#..#",
                "#..#.....#",
                "..#...#...",
                "..###.#.#.",
                "#..#.....#",
                ".#......#.",
                "...##.#..#",
            ],
            "2621": [
                "...##.###.",
                "...#.....#",
                "#.#.##....",
                "#.#.......",
                "##.#.#.#..",
                "...#....##",
                ".......###",
                "..##....##",
                "#.#..#....",
                "#####...#.",
            ],
            "3347": [
                "####..##..",
                "#.#.##....",
                "...#.##...",
                "....##.#.#",
                "####...###",
                "..##..#..#",
                "......#..#",
                "#....#.#..",
                "#....##..#",
                ".#.#.#...#",
            ],
            "1319": [
                "#..###...#",
                "#..##.#..#",
                "#........#",
                "##...#.#.#",
                "#.##....#.",
                ".....#.#.#",
                "#...#....#",
                ".....#...#",
                "#.........",
                ".#.##.....",
            ],
            "1279": [
                "##.....###",
                "##...#....",
                "#....#..##",
                "#...##...#",
                "...#.###.#",
                ".#........",
                "#.....##.#",
                "...#.....#",
                "..###.....",
                "#.#.#..##.",
            ],
            "1861": [
                ".##...#.#.",
                "#....####.",
                "..........",
                "#.#...#..#",
                "###.####..",
                "#......#.#",
                ".......#.#",
                "#.#.#.#..#",
                "##.....#.#",
                "....##..##",
            ],
            "2861": [
                ".#.######.",
                "..#.#..##.",
                "#.##......",
                "....#.#...",
                "........##",
                "#....##...",
                "......#...",
                "#.#.......",
                "#.#....#..",
                "#######..#",
            ],
            "1879": [
                "#..#.....#",
                "#........#",
                "#..#####..",
                "#.#..#..#.",
                "#........#",
                ".#....##.#",
                ".##.....##",
                "...#.....#",
                ".##......#",
                "..###.##.#",
            ],
            "1291": [
                "......##..",
                ".#.....###",
                "...#.#....",
                "#....#.#.#",
                "###.......",
                "....#.....",
                ".#.#.#.#..",
                ".#.##....#",
                "#..#.#....",
                "##..##..#.",
            ],
            "1109": [
                "#....##.##",
                "#.##....##",
                "..#......#",
                ".........#",
                "..#.##.#..",
                "#........#",
                "##.#.....#",
                "##....#...",
                ".......###",
                "##...#.#.#",
            ],
            "2333": [
                "......#..#",
                "##..####..",
                "..#.......",
                "#.........",
                "#.#.##...#",
                "#.........",
                "#.......#.",
                "#.##.#..##",
                ".#..#..#..",
                "###..##..#",
            ],
            "2081": [
                "####...#.#",
                ".....#....",
                ".....##..#",
                ".#..#..#.#",
                "#.........",
                "..##.#...#",
                ".......###",
                ".#..#.....",
                "#......##.",
                "#.#.#.#.##",
            ],
            "1489": [
                "#..##.#..#",
                "..#.#.#.#.",
                "...#......",
                "#........#",
                "#.#.#.....",
                ".#.#.#.#.#",
                "#.##......",
                "#.#.##.#.#",
                "#.#......#",
                ".#..#..#.#",
            ],
            "3931": [
                "##.###.#.#",
                "#........#",
                "#.....#..#",
                ".###......",
                "......##.#",
                "#..#...###",
                "..#......#",
                "#..#......",
                "#....##...",
                "###.###.##",
            ],
            "1249": [
                ".###.###.#",
                "#.##...###",
                "...#.#....",
                "#...#..#..",
                "......#..#",
                "#......###",
                "##..#...#.",
                "..##.....#",
                "#..#.#....",
                "##....####",
            ],
            "2381": [
                "#...#....#",
                ".#...##..#",
                "##...##..#",
                "...#.#...#",
                "#..##.#...",
                ".##..#.##.",
                ".....####.",
                "#..#..##.#",
                "##...##...",
                ".##.######",
            ],
            "1747": [
                ".####..#.#",
                "#........#",
                "....#....#",
                "#.....####",
                "##..#.#..#",
                "###.##..##",
                ".##...#...",
                "..##......",
                "#....###..",
                ".#####..##",
            ],
            "2687": [
                "#.#.....#.",
                ".........#",
                "#..#...#.#",
                "..........",
                "#......##.",
                "..#...##..",
                "##.##...##",
                "##.#...##.",
                "......#..#",
                ".#.#....#.",
            ],
            "1327": [
                ".###.#####",
                ".......#.#",
                "#..#..#.#.",
                "#...#..#..",
                ".......#..",
                "..#.#.....",
                "#........#",
                ".##....#..",
                "..###.#..#",
                "#..#.##.##",
            ],
            "3727": [
                "#.#..#...#",
                "..#.#....#",
                ".##.###.#.",
                "#.........",
                "##.#...#.#",
                "##.#....##",
                ".##...#...",
                "......#..#",
                "........#.",
                "#....##.##",
            ],
            "2341": [
                ".##.#.####",
                "...#....#.",
                ".#.....#.#",
                ".....#....",
                "#.#.###.#.",
                "##.##.....",
                "#...#.....",
                "..#.#..#..",
                "........#.",
                "#.##......",
            ],
            "1439": [
                "#..#.#..##",
                ".......#..",
                "....#..##.",
                "..#..#.#..",
                ".....#...#",
                ".#..#.##..",
                "#...#..#.#",
                "#.#......#",
                ".#..#.....",
                "##.#...#.#",
            ],
            "2351": [
                "..###...##",
                "#....###..",
                ".#....#..#",
                ".#...#....",
                ".#.......#",
                "..#....##.",
                "#..#.....#",
                "#.......#.",
                "##..#..#.#",
                "...#..##..",
            ],
            "2269": [
                ".#####...#",
                "#........#",
                "#.......##",
                "#.#....#..",
                "..##.....#",
                ".#..#..#.#",
                "##...##...",
                "#......###",
                "...#......",
                "#.#.###.#.",
            ],
            "2887": [
                ".#.##.#.##",
                ".#....#...",
                "#.....#..#",
                "#.##...#.#",
                "#...#.#.##",
                "##.##.#...",
                "##.#.##..#",
                ".#.##..#..",
                "......#..#",
                ".#.#.##...",
            ],
            "3391": [
                ".####....#",
                ".#..#..###",
                "....#...#.",
                "...#..#.##",
                "#....#..##",
                "#...#..##.",
                "#..####.#.",
                "..####..##",
                "..##.....#",
                "...#.#..##",
            ],
            "3533": [
                ".#....#..#",
                "#.........",
                "..#..#..##",
                ".#.##.#..#",
                "#...#.....",
                "......##..",
                "...#.#.#.#",
                "#.....##..",
                "..........",
                "##.##..#..",
            ],
            "1637": [
                ".#.#.#.##.",
                "#.#.....##",
                ".#....#...",
                "##.......#",
                ".##.###.##",
                "##.#......",
                "..#.....#.",
                ".###...#.#",
                "........#.",
                "#.##...#.#",
            ],
            "3323": [
                "..#.#.#.#.",
                "#.#.....#.",
                "#.##..#.##",
                "##.......#",
                "#.#....#.#",
                ".##......#",
                ".#..#..#..",
                "..#..##..#",
                "...##.....",
                "##.##.##.#",
            ],
            "1559": [
                "##.##.#..#",
                ".....#.#..",
                "#.#.####..",
                "...#.#...#",
                "##....#..#",
                "#.##...#..",
                ".#..##.###",
                "....#..#..",
                ".#.#.#.#.#",
                "#....#..#.",
            ],
            "2039": [
                "..#.######",
                ".#...#...#",
                "###.#.....",
                "##..###..#",
                ".#...##...",
                "..#..#...#",
                "#.....#.#.",
                "....#.....",
                ".###.....#",
                "..##.#.###",
            ],
            "3677": [
                "####......",
                ".......#..",
                "#.........",
                "........#.",
                ".....###.#",
                "#...#.###.",
                "##........",
                "....##..##",
                ".#....#...",
                ".##..##.#.",
            ],
            "1973": [
                "#.###..##.",
                "#.........",
                "#......###",
                "#.#...####",
                "#.#..#.#.#",
                "..#..#..#.",
                "#..#.#.#.#",
                "##.##..#..",
                "#.###...##",
                "##.#.##.#.",
            ],
            "2309": [
                "####..##.#",
                "#..#..#..#",
                "...#.#...#",
                "#....###.#",
                "##....#.#.",
                "....##....",
                "......#...",
                "##..#.....",
                "#....#..#.",
                ".##.#....#",
            ],
            "2237": [
                ".##......#",
                "#.#....##.",
                "...###..#.",
                "#.#....###",
                ".....#...#",
                "#.##.....#",
                "#..#...#..",
                ".#...#..##",
                "#.#....##.",
                "....#.#.#.",
            ],
            "2663": [
                "##..##.###",
                "#..#..##..",
                "#...##...#",
                "#.#.#..#.#",
                "#..#......",
                "....#..#.#",
                "...#...###",
                "##........",
                "##....#.#.",
                ".#...##.#.",
            ],
            "1571": [
                "##.#.#...#",
                ".##.##.###",
                "........##",
                "#.........",
                "#.#...##..",
                "#.......#.",
                "##..#####.",
                "#..#...##.",
                "##......#.",
                "..#..##..#",
            ],
            "3011": [
                "#.#.#...##",
                "....##.#.#",
                "#...##...#",
                "#........#",
                ".#....#...",
                "......#...",
                "#.#.#..#..",
                "..#####...",
                "#.###.....",
                ".......#.#",
            ],
            "3457": [
                "##.##..#.#",
                "###.##....",
                ".#.#...#..",
                "##.......#",
                ".....#.##.",
                "#.#.##.#.#",
                ".###.#####",
                "..#.......",
                ".##.....##",
                "....#.###.",
            ],
            "1619": [
                "#..#...#..",
                "#.....#.#.",
                "#..#..##..",
                ".....#....",
                "#.#...#...",
                ".#..#....#",
                "#....##.##",
                ".....##.#.",
                "......####",
                "#.#.#.##..",
            ],
            "1663": [
                "..#..###.#",
                "#...#.#..#",
                "#...#.....",
                "###..##...",
                "..#.#.....",
                "..........",
                "#.#....##.",
                "..#....###",
                "#..#..#.#.",
                "###.#.##..",
            ],
        }
        if not do:
            return
        self.__tiles = {}
        current_tile = None
        for i in self._input_data:
            if i == "":
                continue
            # print(f"{i=}")
            if "Tile" in i:
                current_tile = int(re.findall("\d+", i)[0])
                self.__tiles[current_tile] = []
            else:
                self.__tiles[current_tile].append(i)
        local = {}
        for i in self.__tiles:
            local[i] = Tile(self.__get_borders(i))

        self.__adj = {}
        for k1, v1 in local.items():
            north_match = set()
            east_match = set()
            south_match = set()
            west_match = set()
            for k2, v2 in local.items():
                if k1 == k2:
                    continue
                if v1.s_border == v2.n_border:
                    south_match.add(k2)
                if v1.s_border == v2.flip().n_border:
                    south_match.add(k2)
                if v1.s_border == v2.rotate90().n_border:
                    south_match.add(k2)
                if v1.s_border == v2.rotate180().n_border:
                    south_match.add(k2)
                if v1.s_border == v2.rotate270().n_border:
                    south_match.add(k2)

                if v1.flip().s_border == v2.flip().n_border:
                    south_match.add(k2)
                if v1.flip().s_border == v2.rotate90().n_border:
                    south_match.add(k2)
                if v1.flip().s_border == v2.rotate180().n_border:
                    south_match.add(k2)
                if v1.flip().s_border == v2.rotate270().n_border:
                    south_match.add(k2)

                if v1.rotate90().s_border == v2.flip().n_border:
                    south_match.add(k2)
                if v1.rotate90().s_border == v2.rotate90().n_border:
                    south_match.add(k2)
                if v1.rotate90().s_border == v2.rotate180().n_border:
                    south_match.add(k2)
                if v1.rotate90().s_border == v2.rotate270().n_border:
                    south_match.add(k2)

                if v1.rotate180().s_border == v2.flip().n_border:
                    south_match.add(k2)
                if v1.rotate180().s_border == v2.rotate90().n_border:
                    south_match.add(k2)
                if v1.rotate180().s_border == v2.rotate180().n_border:
                    south_match.add(k2)
                if v1.rotate180().s_border == v2.rotate270().n_border:
                    south_match.add(k2)

                if v1.rotate270().s_border == v2.flip().n_border:
                    south_match.add(k2)
                if v1.rotate270().s_border == v2.rotate90().n_border:
                    south_match.add(k2)
                if v1.rotate270().s_border == v2.rotate180().n_border:
                    south_match.add(k2)
                if v1.rotate270().s_border == v2.rotate270().n_border:
                    south_match.add(k2)

                # breakpoint()
                if v1.e_border == v2.w_border:
                    east_match.add(k2)
                if v1.e_border == v2.flip().w_border:
                    east_match.add(k2)
                if v1.e_border == v2.rotate90().w_border:
                    east_match.add(k2)
                if v1.e_border == v2.rotate180().w_border:
                    east_match.add(k2)
                if v1.e_border == v2.rotate270().w_border:
                    east_match.add(k2)

                if v1.flip().e_border == v2.flip().w_border:
                    east_match.add(k2)
                if v1.flip().e_border == v2.rotate90().w_border:
                    east_match.add(k2)
                if v1.flip().e_border == v2.rotate180().w_border:
                    east_match.add(k2)
                if v1.flip().e_border == v2.rotate270().w_border:
                    east_match.add(k2)

                if v1.rotate90().e_border == v2.flip().w_border:
                    east_match.add(k2)
                if v1.rotate90().e_border == v2.rotate90().w_border:
                    east_match.add(k2)
                if v1.rotate90().e_border == v2.rotate180().w_border:
                    east_match.add(k2)
                if v1.rotate90().e_border == v2.rotate270().w_border:
                    east_match.add(k2)

                if v1.rotate180().e_border == v2.flip().w_border:
                    east_match.add(k2)
                if v1.rotate180().e_border == v2.rotate90().w_border:
                    east_match.add(k2)
                if v1.rotate180().e_border == v2.rotate180().w_border:
                    east_match.add(k2)
                if v1.rotate180().e_border == v2.rotate270().w_border:
                    east_match.add(k2)

                if v1.rotate270().e_border == v2.flip().w_border:
                    east_match.add(k2)
                if v1.rotate270().e_border == v2.rotate90().w_border:
                    east_match.add(k2)
                if v1.rotate270().e_border == v2.rotate180().w_border:
                    east_match.add(k2)
                if v1.rotate270().e_border == v2.rotate270().w_border:
                    east_match.add(k2)

                # breakpoint()
                if v1.n_border == v2.s_border:
                    north_match.add(k2)
                if v1.n_border == v2.flip().s_border:
                    north_match.add(k2)
                if v1.n_border == v2.rotate90().s_border:
                    north_match.add(k2)
                if v1.n_border == v2.rotate180().s_border:
                    north_match.add(k2)
                if v1.n_border == v2.rotate270().s_border:
                    north_match.add(k2)

                if v1.flip().n_border == v2.flip().s_border:
                    north_match.add(k2)
                if v1.flip().n_border == v2.rotate90().s_border:
                    north_match.add(k2)
                if v1.flip().n_border == v2.rotate180().s_border:
                    north_match.add(k2)
                if v1.flip().n_border == v2.rotate270().s_border:
                    north_match.add(k2)

                if v1.rotate90().n_border == v2.flip().s_border:
                    north_match.add(k2)
                if v1.rotate90().n_border == v2.rotate90().s_border:
                    north_match.add(k2)
                if v1.rotate90().n_border == v2.rotate180().s_border:
                    north_match.add(k2)
                if v1.rotate90().n_border == v2.rotate270().s_border:
                    north_match.add(k2)

                if v1.rotate180().n_border == v2.flip().s_border:
                    north_match.add(k2)
                if v1.rotate180().n_border == v2.rotate90().s_border:
                    north_match.add(k2)
                if v1.rotate180().n_border == v2.rotate180().s_border:
                    north_match.add(k2)
                if v1.rotate180().n_border == v2.rotate270().s_border:
                    north_match.add(k2)

                if v1.rotate270().n_border == v2.flip().s_border:
                    north_match.add(k2)
                if v1.rotate270().n_border == v2.rotate90().s_border:
                    north_match.add(k2)
                if v1.rotate270().n_border == v2.rotate180().s_border:
                    north_match.add(k2)
                if v1.rotate270().n_border == v2.rotate270().s_border:
                    north_match.add(k2)
                # breakpoint()
                if v1.w_border == v2.e_border:
                    west_match.add(k2)
                if v1.w_border == v2.flip().e_border:
                    west_match.add(k2)
                if v1.w_border == v2.rotate90().e_border:
                    west_match.add(k2)
                if v1.w_border == v2.rotate180().e_border:
                    west_match.add(k2)
                if v1.w_border == v2.rotate270().e_border:
                    west_match.add(k2)

                if v1.flip().w_border == v2.flip().e_border:
                    west_match.add(k2)
                if v1.flip().w_border == v2.rotate90().e_border:
                    west_match.add(k2)
                if v1.flip().w_border == v2.rotate180().e_border:
                    west_match.add(k2)
                if v1.flip().w_border == v2.rotate270().e_border:
                    west_match.add(k2)

                if v1.rotate90().w_border == v2.flip().e_border:
                    west_match.add(k2)
                if v1.rotate90().w_border == v2.rotate90().e_border:
                    west_match.add(k2)
                if v1.rotate90().w_border == v2.rotate180().e_border:
                    west_match.add(k2)
                if v1.rotate90().w_border == v2.rotate270().e_border:
                    west_match.add(k2)

                if v1.rotate180().w_border == v2.flip().e_border:
                    west_match.add(k2)
                if v1.rotate180().w_border == v2.rotate90().e_border:
                    west_match.add(k2)
                if v1.rotate180().w_border == v2.rotate180().e_border:
                    west_match.add(k2)
                if v1.rotate180().w_border == v2.rotate270().e_border:
                    west_match.add(k2)

                if v1.rotate270().w_border == v2.flip().e_border:
                    west_match.add(k2)
                if v1.rotate270().w_border == v2.rotate90().e_border:
                    west_match.add(k2)
                if v1.rotate270().w_border == v2.rotate180().e_border:
                    west_match.add(k2)
                if v1.rotate270().w_border == v2.rotate270().e_border:
                    west_match.add(k2)
            self.__adj[k1] = north_match | east_match | south_match | west_match

    def __get_borders(self, i):
        return [
            self.__tiles[i][0],
            "".join([j[-1] for j in self.__tiles[i]]),
            self.__tiles[i][-1],
            "".join([j[0] for j in self.__tiles[i]]),
        ]

    def _calculate_1(self):
        return prod(k for k, v in self.__adj.items() if len(v) == 2)

    def _calculate_2(self):
        # self._preprocess_input(True)
        import math

        size = int(math.sqrt(len(self.__tiles)))
        # breakpoint()
        # print(json.dumps(self.__adj, cls=SetEncoder))
        # print(json.dumps(self.__tiles, cls=SetEncoder))
        # return
        # print(f"{self.__adj=}")
        edges = [k for k, v in self.__adj.items() if len(v) == 2]
        borders = [k for k, v in self.__adj.items() if len(v) == 3]
        grid = []
        for i in range(size):
            x = []
            for j in range(size):
                x.append(0)
            grid.append(x)
        grid[0][0] = edges[0]
        # print(grid)
        found_x = 0
        y = 0
        for i in self.__adj[edges[0]]:
            # print(i)
            if i in borders:
                # print(i)
                if not found_x:
                    grid[found_x + 1][0] = i
                    found_x += 1
                else:
                    grid[0][y + 1] = i
                    y += 1
        # print(grid)
        for i in range(1, size - 1):
            # print(grid[0][i])
            for j in self.__adj[grid[0][i]]:
                # print(j)
                if j == grid[0][i - 1]:
                    # print("prev")
                    continue
                if j in borders:
                    grid[0][i + 1] = j
                if j in edges:
                    grid[0][i + 1] = j
                    # print("edge!")
            for j in self.__adj[grid[i][0]]:
                # print(j)
                if j == grid[i - 1][0]:
                    # print("prev")
                    continue
                if j in borders:
                    grid[i + 1][0] = j
                if j in edges:
                    grid[i + 1][0] = j
                    # print("edge!")
        # print(*grid, sep="\n")
        for i in range(0, size - 1):
            for j in self.__adj[grid[size - 1][i]]:
                if j == grid[size - 1][i - 1] or j == grid[size - 2][i]:
                    # print("prev")
                    continue
                if j in borders:
                    grid[size - 1][i + 1] = j
                if j in edges:
                    grid[size - 1][i + 1] = j
                    # print("edge!")
            for j in self.__adj[grid[i][size - 1]]:
                if j == grid[i - 1][size - 1] or j == grid[i][size - 2]:
                    # print("prev")
                    continue
                if j in borders:
                    grid[i + 1][size - 1] = j
                if j in edges:
                    grid[i + 1][size - 1] = j
                    # print("edge!")
        # breakpoint()
        # print(*grid, sep="\n")
        for c, i in enumerate(grid):
            # print(i)
            if c == len(grid) - 2:
                break
            for d, j in enumerate(i):
                if j in edges:
                    continue
                for k in self.__adj[j]:
                    if k in i or k in grid[c - 1]:
                        # print(f"{k} in row {i}: parsing {j}")
                        ...
                    else:
                        grid[c + 1][d] = k
        # print(edges)
        print(*grid, sep="\n")
        # rebuild image
        # print(*flip(self.__tiles[grid[0][0]]), sep="\n")
        # print()
        # print(grid[1][0])
        # print(*flip(self.__tiles[grid[1][0]]), sep="\n")
        # print()
        # print(*rotate90(self.__tiles[grid[1][0]]), sep="\n")
        # print()
        # print(*rotate180(self.__tiles[grid[1][0]]), sep="\n")
        # print()
        # print(*rotate270(self.__tiles[grid[1][0]]), sep="\n")
        return 0


def flip(tile):
    x = reversed(tile)
    # print(tile)
    return x


def rotate90(tile):
    x = []
    for i in tile:
        y = []
        for _ in i:
            y.append(0)
        x.append(y)
    # print(*x, sep="\n")
    for i in range(len(tile)):
        for j in range(len(tile)):
            # print(f"{i},{j}")
            x[i][j] = tile[len(tile) - 1 - j][i]
            # print(*x, sep="\n")
    # print(tile)
    return ["".join(i) for i in x]


def rotate180(tile):
    return rotate90(rotate90(tile))


def rotate270(tile):
    return rotate90(rotate180(tile))
